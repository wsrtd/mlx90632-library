<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MLX90632 Driver Library: Introduction and Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="melexis-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MLX90632 Driver Library
   &#160;<span id="projectnumber">134a56a9</span>
   </div>
   <div id="projectbrief">Universal MCU library for the 90632</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Introduction and Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This is 90632 example driver with virtual i2c read/write functions. There will be some mapping needed with MCU's own i2c read/write procedures, but the core calculations should remain the same. Functions that need to be implemented for each individual MCU are listed in <code><a class="el" href="mlx90632__depends_8h.html" title="MLX90632 driver dependencies. ">mlx90632_depends.h</a></code> file.</p>
<p>Since there is one source and two header files they can be built also just as normal source files. They are dependent on mathlib and errno so appropriate flags are required. For ease of development and unit-testing Makefile was added with following targets:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# All targets can take `CC=clang` variable, otherwise default compiler is GCC. If</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# you need to cross-compile just feed `CROSS_COMPILE` variable to Makefile</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;make libs   # builds library with single file. Include inc/ for header definitions</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;make doxy   # builds doxygen documentation in build/html/</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;make utest  # builds and runs unit test program mlx90632 (dependent on ceedling)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;make all    # builds unit tests, doxygen documentation, coverage information and library</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;make coverage   # builds coverage information</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;make clean  # cleans the crap make has made</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;make uncrustify # style fixup of the source, header and test files</div></div><!-- fragment --><p>Datasheet is available in <a href="https://www.melexis.com/en/documents/documentation/datasheets/datasheet-mlx90632">Melexis documentation</a>.</p>
<h1><a class="anchor" id="example_sec"></a>
Example program flow</h1>
<p>You can either include library directly or object file. Definitions are found in library <code>inc/</code> folder and you need to point your compiler <code>-I</code> flag there.</p>
<p>After you have your environment set you need to enter below flow to your program.</p>
<div class="fragment"><div class="line"><span class="comment">/* Before include, make sure you have BITS_PER_LONG defined. This is a CPU</span></div><div class="line"><span class="comment"> * specific value which is used to generate bit masks. You can also use -D</span></div><div class="line"><span class="comment"> * to input definition to compiler via command line</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mlx90632_8h.html">mlx90632.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/* Declare and implement here functions you find in mlx90632_depends.h */</span></div><div class="line"></div><div class="line"><span class="comment">/* You can use global or local storage for EEPROM register values so declare</span></div><div class="line"><span class="comment"> * them whereever you want. Do not forget to declare ambient_new_raw,</span></div><div class="line"><span class="comment"> * ambient_old_raw, object_new_raw, object_old_raw</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    int32_t ret = 0; </div><div class="line">    <span class="keywordtype">double</span> ambient; </div><div class="line">    <span class="keywordtype">double</span> object; </div><div class="line">    <span class="comment">/* Read sensor EEPROM registers needed for calcualtions */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Now we read current ambient and object temperature */</span></div><div class="line">    ret = <a class="code" href="group__mlx90632__private.html#ga36c61b9d5417e77e415500ab45055053">mlx90632_read_temp_raw</a>(&amp;ambient_new_raw, &amp;ambient_old_raw,</div><div class="line">                                 &amp;object_new_raw, &amp;object_old_raw);</div><div class="line">    <span class="keywordflow">if</span>(ret &lt; 0)</div><div class="line">        <span class="comment">/* Something went wrong - abort */</span></div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line"></div><div class="line">    <span class="comment">/* Now start calculations (no more i2c accesses) */</span></div><div class="line">    <span class="comment">/* Calculate ambient temperature */</span></div><div class="line">    ambient = <a class="code" href="group__mlx90632__private.html#ga7939b85a05b6d8899c0d793b37388a0d">mlx90632_calc_temp_ambient</a>(ambient_new_raw, ambient_old_raw,</div><div class="line">                                         P_T, P_R, P_G, P_O, Gb);</div><div class="line"></div><div class="line">    <span class="comment">/* Get preprocessed temperatures needed for object temperature calculation */</span></div><div class="line">    <span class="keywordtype">double</span> pre_ambient = <a class="code" href="group__mlx90632__private.html#ga06bcec82dba1e3d947dbca8203ca7e43">mlx90632_preprocess_temp_ambient</a>(ambient_new_raw,</div><div class="line">                                                          ambient_old_raw, Gb);</div><div class="line">    <span class="keywordtype">double</span> pre_object = <a class="code" href="group__mlx90632__private.html#gaca7c5dd5a81d4e98de37195023bec370">mlx90632_preprocess_temp_object</a>(object_new_raw, object_old_raw,</div><div class="line">                                                        ambient_new_raw, ambient_old_raw,</div><div class="line">                                                        Ka);</div><div class="line">    <span class="comment">/* Calculate object temperature */</span></div><div class="line">    <span class="keywordtype">object</span> = <a class="code" href="group__mlx90632__private.html#gadaa9b8a1b74083aeee178f313fbad260">mlx90632_calc_temp_object</a>(<span class="keywordtype">object</span>, ambient, Ea, Eb, Ga, Fa, Fb, Ha, Hb);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
    <img class="footer" src="doxygen/images/melexis-logo.png" alt="Melexis N.V," height="25px" hspace="10"/>
	&copy; Copyright 2015 Melexis N.V. ---
    Generated on Wed Aug 5 2020 21:48:33 for MLX90632 Driver Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
